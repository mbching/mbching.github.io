<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>香港天氣預報</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: monospace;
      margin: 2rem;
    }
    h1, h2 {
      text-transform: uppercase;
      border-bottom: 2px solid #444;
      padding-bottom: 0.3rem;
    }
    h1 {
      font-size: 2rem;
    }
    h2 {
      margin-top: 2rem;
      font-size: 1.5rem;
    }
    .section {
      margin-top: 1.5rem;
    }
    pre {
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 1rem;
    }
    .day-block {
      margin-top: 1rem;
    }
    .day-title {
      font-weight: bold;
      margin-bottom: 0.3rem;
      color: #ccc;
    }
    footer {
      font-size: 0.8rem;
      margin-top: 3rem;
      color: #666;
    }
    .psr-bar {
      font-size: 1rem;
      color: #00f;
    }
  </style>
</head>
<body>
  <h1>香港天氣預報</h1>

  <div class="section">
    <h2>今日天氣概況</h2>
    <pre id="today">載入中...</pre>
  </div>

  <div class="section">
    <h2>九天天氣預報</h2>
    <div id="nineday">載入中...</div>
  </div>

  <footer>資料來源：data.weather.gov.hk</footer>

  <script>
    // Fetch today's forecast
    fetch("https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=flw&lang=tc")
      .then(res => res.json())
      .then(data => {
        const content = `${data.updateTime}\n\n${data.generalSituation}\n\n${data.forecastDesc}\n\n${data.outlook}`;
        document.getElementById("today").textContent = content;
      })
      .catch(() => {
        document.getElementById("today").textContent = "無法載入今日天氣資料。";
      });

    // Function to generate PSR bar based on the values: 高, 中, 低
    function generatePSRBar(psr) {
      if (psr === "高") return "█ █ █ █ █ █ █ █ █ █";  // Full bar (High)
      if (psr === "中") return "▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄";  // Medium bar (Medium)
      if (psr === "低") return "▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁";  // Low bar (Low)
      return "資料缺失";  // Missing data
    }

    // Fetch 9-day forecast
    fetch("https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=fnd&lang=tc")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("nineday");
        container.innerHTML = "";
        data.weatherForecast.forEach(day => {
          const psr = day.PSR ? generatePSRBar(day.PSR) : "資料缺失";

          const block = document.createElement("div");
          block.className = "day-block";
          block.innerHTML = `
            <div class="day-title">${day.forecastDate}（${day.week}）</div>
            <pre>
天氣：${day.forecastWeather}
溫度：${day.forecastMintemp.value}°C ~ ${day.forecastMaxtemp.value}°C
濕度：${day.forecastMinrh.value}% ~ ${day.forecastMaxrh.value}%
風勢：${day.forecastWind}
降雨機會：${psr}
            </pre>
          `;
          container.appendChild(block);
        });
      })
      .catch(() => {
        document.getElementById("nineday").textContent = "無法載入九天天氣資料。";
      });
  </script>
</body>
</html>
